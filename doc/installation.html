<html>
	<head>
		<title>Installation</title>
	</head>

	<body>
		<h1>How to Install Mireka</h1>
These instructions describe how to set up a single, standalone instance of Mireka. 
You should have have installed JDK 1.6+.		
<ol>
	<li><a href="http://www.caucho.com/download/">Download</a> and install 
	<a href="http://caucho.com/resin/">Resin</a> 4.0.10 open source edition 
	as per the Resin instructions. The Resin install directory is referenced in this document 
	as <dfn>${resin.dir}</dfn>. You may want to configure a fixed JMX port on 
	Resin, so you will be able to use jconsole to monitor Mireka.
	</li>
	<li>Download and unzip the Mireka distribution. The installation directory 
	may be for example <kbd>"C:\Program&nbsp;Files\Mireka"</kbd> on Windows or 
	<kbd>/var/lib/mireka</kbd> on Ubuntu.
	This directory is referenced in this document as <dfn>${mirekaHome}</dfn}.
	</li>
	<li>On Linux ensure that Resin has the necessary permissions:
		<ul>
			<li>write access to the <kbd>${mirekaHome}/log</kbd> and 
			<kbd>${mirekaHome}/postmaster</kbd> directories and to 
			the subdirectories of the <kbd>${mirekaHome}/queues</kbd> 
			directory.</li>
			<li>permission to open the configured ports, e.g. 25, 587.</li>
		</ul>
		For more information see <a href="#ubuntu-permissions">Permissions on Ubuntu</a>. 
	</li>
	<li>Configure the <var>mirekaHome</var> variable in Resin. 
	To do this, edit <kbd>${resin.dir}/conf/resin.xml</kbd>. After the line:<br>
	<code>&lt;host id="" root-directory="."&gt;</code><br>
	insert this line:<br>
	<code>&lt;resin:set var="mirekaHome" value="YOUR_DIR" /&gt;</code><br>
	where <code>YOUR_DIR</code> should be the ${mirekaHome} directory.
	</li>
	<li>Copy <kbd>mireka.war</kbd> to <kbd>${resin.dir}/webapps/</kbd></li>
	<li>Configure Mireka by editing its configuration files in the 
	<kbd>${mirekaHome}/conf/</kbd> directory. For more information,
	see <a href="configuration.html">Configuration</a>.
	</li>
	<li>Start Resin. For more information on this, see the documentation of Resin.</li>
</ol>

<p>
To verify that everyting is going well, look at the log files in 
<kbd>${resin.dir}/log</kbd> and <kbd>${mirekaHome}/log</kbd>.
</p>

<a name="ubuntu-permissions">
<h3>Permissions on Ubuntu</h3>
On Ubuntu by default Resin runs as user <kbd>www-data</kbd>, 
which has no permissions to open ports below 1024. 
<p>The easiest way to have the necessary permissions is to run Resin as root. 
Comment out, or delete these lines in <kbd>${resin.dir}/conf/resin.xml</kbd>:
<pre>
	&lt;resin:if test="${resin.userName == 'root'}">
		&lt;user-name>www-data&lt;/user-name>
		&lt;group-name>www-data&lt;/group-name>
	&lt;/resin:if>
</pre>
</p>
Another solution is to use the <kbd>authbind</kbd> command.
Install the package providing <kbd>authbind</kbd> by issuing 
the command 
<pre>
	sudo apt-get install authbind
</pre>
Modify <kbd>/etc/init.d/resin</kbd> by replacing 
<pre>
	JAVA="$JAVA_HOME/bin/java"		
</pre>
with 
<pre>
	JAVA="/usr/bin/authbind --deep $JAVA_HOME/bin/java"		
</pre>
Replace 
<pre>
	ARGS="$RESIN_CONF $RESIN_LOG $RESIN_ROOT $SERVER"
</pre>
with 
<pre>
	ARGS="$RESIN_CONF $RESIN_LOG $RESIN_ROOT $SERVER -Djava.net.preferIPv4Stack=true"
</pre>
For all required ports, create an empty file named like <kbd>/etc/authbind/byport/587</kbd>  
with executable permissions for the user <kbd>www-data</kbd>.


	</body>
</html>
