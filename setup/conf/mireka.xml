<web-app xmlns="http://caucho.com/ns/resin"
	xmlns:resin="urn:java:com.caucho.resin"
	xmlns:mireka="urn:java:mireka"
	xmlns:subetha="urn:java:org.subethamail.smtp.server"
	>
	
	<system-property mireka.home="${mirekaHome}"/>
	<system-property logback.configurationFile="${__DIR__}/logback.xml"/>
	<dependency path="${__DIR__}/logback.xml" />

	<system-property helo="mail.example.com"/>
	<!-- 
		Uncomment to set global JSSE TLS settings. This is not necessary 
		if TLS is not used or if it is configured for each service 
		separately.
	-->
	<!--
	<system-property javax.net.ssl.keyStore="${mirekaHome}/conf/keystore.jks"/>
	<system-property javax.net.ssl.keyStorePassword="changeit"/>
	-->
	
	<mireka:HomeDir>
		<path>${mirekaHome}</path>
	</mireka:HomeDir>

	<mireka:ClientFactory>
		<Named>clientFactory</Named>
		<mireka:helo>${helo}</mireka:helo>
		<!-- <mireka:bind>192.0.2.0</mireka:bind> -->
	</mireka:ClientFactory>
	
	<!--
		the next element can be commented out if none of the proxy 
		services are enabled
	-->
	<mireka:BackendServer>
		<Named>backendServer</Named>
		
		<mireka:host>backend.example.com</mireka:host>
		<mireka:clientFactory>
			#{clientFactory}
		</mireka:clientFactory>
	</mireka:BackendServer>
	
	<mireka:MaildropRepository>
		<Named>maildropRepository</Named>
		 <ApplicationScoped/>
		<mireka:dir>${mirekaHome}/maildrops</mireka:dir>
	</mireka:MaildropRepository>
	
	<resin:import path="${__DIR__}/domains.xml" />
	<resin:import path="${__DIR__}/global-users.xml" />
	
	<LocalRecipientTable xmlns="urn:java:mireka">
		<Named xmlns="http://caucho.com/ns/resin">localRecipientsTable</Named>
		<localDomains>#{localDomains}</localDomains>
		
		<resin:import path="${__DIR__}/alias.xml" />
		
		<mapper>
			<MailingLists>
				<resin:import path="${__DIR__}/lists.xml" />
			</MailingLists>
		</mapper>
		
		<mapper>
			<ForwardLists>
				<resin:import path="${__DIR__}/forwards.xml" />
			</ForwardLists>
		</mapper>

		<resin:import path="${__DIR__}/others.xml" />
		
		<!-- 
			comment out if POP service is not active
		-->
		<mapper>
			<GlobalUsersMaildropDestinationMapper>
				<maildropRepository>#{maildropRepository}</maildropRepository>
				<users>#{globalUsers}</users>
			</GlobalUsersMaildropDestinationMapper>
		</mapper>
		
	</LocalRecipientTable>
	
	
	<!--
		uncomment to run the POP3 server
	-->
	<!--
	<resin:import path="${__DIR__}/pop/pop.xml" />
	-->
	
	<!--
		uncomment to run the RFC 4409 message submission service

		This service - depending on its configuration - either directly 
		transmits messages to the mail servers of the recipient on the 
		internet, or relays messages to a backend server.
	-->
	<!--
	<system-property submissionServiceActive="true"/>
	<resin:import path="${__DIR__}/submission/submission.xml" />
	-->
	
	<!--
		uncomment to run the MX SMTP server
		
		This service - depending on its configuration - either relay  
		a message to a backend server, or deliver it into a local POP3
		maildrop. 
	-->
	<!--
	<resin:import path="${__DIR__}/mx/mx.xml" />
	-->	
	
</web-app>